# 微服务集成文档

## 概述

Translator Agent 已完成微服务架构集成，实现了专业的微服务状态监控和管理功能。

## 已实现功能

### 1. 微服务配置管理 (`src/config/MicroserviceConfig.ts`)

#### 核心服务配置
- **专业视频翻译服务** (`video-translate`)
  - 端点: `http://localhost:8001`
  - 能力: 视频翻译、音频提取、语音克隆、字幕同步
  - 资源限制: 4GB 内存, 4核 CPU, 5分钟超时

- **字幕提取服务** (`subtitle-extract`)
  - 端点: `http://localhost:8002`
  - 能力: 字幕提取、语音识别、说话人分离
  - 资源限制: 2GB 内存, 2核 CPU, 3分钟超时

- **字幕翻译服务** (`text-translate`)
  - 端点: `http://localhost:8003`
  - 能力: 翻译、摘要、情感分析、上下文保持
  - 资源限制: 1GB 内存, 1核 CPU, 1分钟超时

- **字幕同步服务** (`subtitle-sync`)
  - 端点: `http://localhost:8004`
  - 能力: 时间对齐、同步校正、冲突检测
  - 资源限制: 1GB 内存, 1核 CPU, 2分钟超时

- **字幕擦除服务** (`subtitle-erasure`)
  - 端点: `http://localhost:8005`
  - 能力: 字幕去除、视频修复、质量增强
  - 资源限制: 3GB 内存, 3核 CPU, 4分钟超时

- **视频字幕压制服务** (`video-subtitle-pressing`)
  - 端点: `http://localhost:8006`
  - 能力: 字幕烧录、样式定制、位置调整
  - 资源限制: 4GB 内存, 4核 CPU, 5分钟超时

- **AI 视频叙事服务** (`ai-video-narrative`)
  - 端点: `http://localhost:8007`
  - 能力: 故事生成、语音旁白、场景检测、情感分析
  - 资源限制: 8GB 内存, 8核 CPU, 10分钟超时

- **ModelScope 服务** (`modelscope-service`)
  - 端点: `http://localhost:8008`
  - 能力: 翻译、语音识别、视频处理、NLP
  - 资源限制: 4GB 内存, 4核 CPU, 2分钟超时

#### 核心功能
- 服务健康检查
- 依赖关系管理
- 资源限制配置
- 服务状态更新
- 推荐服务获取

### 2. 微服务状态监控组件 (`src/components/MicroserviceStatus.tsx`)

#### 组件列表
1. **MicroserviceStatus**: 全局服务状态概览
   - 实时显示所有服务状态
   - 健康检查和延迟监控
   - 服务统计信息

2. **ModuleServiceStatus**: 模块专用服务状态
   - 显示特定模块的服务状态
   - 实时延迟监控
   - 状态指示器

3. **ServiceDependencyTree**: 服务依赖树
   - 显示服务依赖关系
   - 依赖服务健康状态
   - 依赖链可视化

4. **ServiceConfigDetails**: 服务配置详情
   - 显示服务详细配置
   - 资源限制信息
   - 支持能力列表

#### 监控功能
- 实时状态刷新 (30秒间隔)
- 健康检查 API 调用
- 延迟测量和显示
- 错误状态处理
- 服务统计汇总

### 3. 微服务集成页面 (`src/pages/MicroserviceIntegrationPage.tsx`)

#### 页面功能
1. **概览面板**
   - 服务总数统计
   - 运行中/离线/维护中服务数量
   - 系统健康状态
   - 快速操作按钮

2. **服务列表**
   - 所有微服务详细状态
   - 模块专用服务状态
   - 服务依赖关系展示
   - 实时刷新功能

3. **配置详情**
   - 服务端点配置
   - 资源限制详情
   - 依赖服务列表
   - 支持能力展示

4. **监控面板**
   - 实时资源使用率 (CPU/内存/网络)
   - 服务调用统计
   - 成功率和延迟监控
   - 依赖关系拓扑图

#### UI 特性
- 响应式布局
- 实时数据更新
- 颜色编码状态指示
- 交互式标签页
- 任务隔离上下文显示

### 4. 应用集成 (`src/App.tsx`)

#### 集成内容
- 添加微服务页面路由
- 顶部导航栏微服务按钮
- 页面状态管理
- 返回主页功能

## 使用指南

### 访问微服务页面
1. 启动应用后，在顶部导航栏点击"微服务"按钮
2. 页面将显示所有微服务的实时状态
3. 可以通过标签页切换不同视图

### 监控服务状态
1. **概览视图**: 查看整体健康状态和统计信息
2. **服务列表**: 查看每个服务的详细状态和延迟
3. **配置详情**: 查看服务配置和资源限制
4. **监控面板**: 查看实时资源使用和调用统计

### 健康检查
1. 系统会自动每30秒检查一次服务健康状态
2. 可以点击"刷新状态"按钮手动刷新
3. 健康状态通过颜色编码显示：
   - 绿色: 运行中
   - 红色: 离线
   - 黄色: 维护中
   - 蓝色: 检查中

### 依赖关系管理
1. 每个模块的服务都会显示其依赖的服务
2. 依赖服务的健康状态会实时更新
3. 如果依赖服务异常，会显示警告信息

## 技术实现

### 健康检查机制
```typescript
// 使用 Fetch API 进行健康检查
const response = await fetch(
  `${service.serviceEndpoint.url}${service.serviceEndpoint.healthCheck}`,
  { method: 'GET', timeout: 5000 }
);
return response.ok;
```

### 实时监控
- 使用 `setInterval` 定时刷新状态
- 每个服务独立进行健康检查
- 错误处理和重试机制

### 状态管理
- 使用 React 状态管理服务状态
- 任务隔离上下文集成
- 实时数据更新和渲染

## 配置说明

### 服务端点配置
所有服务端点在 `MicroserviceConfig.ts` 中定义，可以根据实际部署环境修改：

```typescript
serviceEndpoint: {
  name: 'service-name',
  url: 'http://localhost:8001',  // 修改为实际服务地址
  healthCheck: '/health',
  capabilities: ['capability1', 'capability2'],
  status: 'active'
}
```

### 资源限制配置
每个服务可以配置独立的资源限制：

```typescript
options: {
  timeout: 300000,  // 超时时间 (毫秒)
  retry: 3,         // 重试次数
  priority: 1,      // 优先级 (1-5)
  resourceLimits: {
    maxMemory: 4096,  // 最大内存 (MB)
    maxCpu: 4,        // 最大CPU核心数
    maxDuration: 600  // 最大执行时间 (秒)
  }
}
```

## 扩展指南

### 添加新服务
1. 在 `MicroserviceConfig.ts` 中添加新的服务配置
2. 在 `MicroserviceStatus.tsx` 中添加对应的组件（如果需要）
3. 在 `MicroserviceIntegrationPage.tsx` 中添加服务展示

### 修改现有服务
1. 更新 `MicroserviceConfig.ts` 中的服务配置
2. 重启应用以应用新的配置

### 自定义监控
1. 可以修改健康检查间隔时间
2. 可以添加自定义的监控指标
3. 可以扩展监控面板的显示内容

## 故障排除

### 服务显示离线
1. 检查服务是否正在运行
2. 检查服务端点配置是否正确
3. 检查网络连接是否正常
4. 查看浏览器控制台错误信息

### 延迟过高
1. 检查服务负载情况
2. 检查网络状况
3. 考虑增加资源限制或优化服务性能

### 依赖服务异常
1. 检查依赖服务是否正常运行
2. 检查服务间网络连接
3. 查看依赖服务的日志

## 下一步计划

### 短期目标
1. 集成真实后端 API 调用
2. 添加服务负载均衡
3. 实现服务发现机制

### 长期目标
1. 添加服务自动扩缩容
2. 实现服务熔断和降级
3. 添加服务链路追踪
4. 集成服务日志收集

## 总结

微服务集成模块提供了完整的微服务状态监控和管理功能，支持：
- 实时健康检查
- 服务状态监控
- 依赖关系管理
- 资源使用监控
- 故障诊断

该模块为 Translator Agent 的微服务架构提供了强大的运维支持，确保系统的高可用性和可维护性。